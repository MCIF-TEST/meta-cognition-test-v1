<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCIF Logic Debug Dashboard</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: #0f1117;
      color: #e0e0e0;
      padding: 40px;
    }
    h1, h2 {
      color: #90caf9;
      text-align: center;
      margin-bottom: 30px;
    }
    section {
      background: #1a1d24;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    pre {
      background: #111319;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      color: #b0bec5;
      font-size: 0.9em;
    }
    button {
      background: #1976d2;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #42a5f5;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .metric {
      background: #111319;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      color: #90caf9;
      box-shadow: inset 0 0 8px rgba(25,118,210,0.4);
    }
  </style>
</head>
<body>
  <h1>⚙️ MCIF Logic Debug Dashboard</h1>

  <section>
    <h2>Simulation Controls</h2>
    <button id="initBtn">Initialize Engine</button>
    <button id="nextBtn">Next Question</button>
    <button id="simulateAI">Simulate AI Call</button>
    <button id="resetSession">Reset Session</button>
  </section>

  <section>
    <h2>Current Question</h2>
    <pre id="questionOutput">Press "Initialize Engine" to begin.</pre>
  </section>

  <section>
    <h2>Engine State</h2>
    <div class="grid" id="engineState"></div>
  </section>

  <section>
    <h2>AI Query Log</h2>
    <pre id="aiLog">No AI queries yet.</pre>
  </section>

  <section>
    <h2>Session Data</h2>
    <pre id="sessionData">No session data yet.</pre>
  </section>

  <script type="module">
    import * as MCIFLogic from "../scripts/logic.js";
    import * as MCIFData from "../scripts/data.js";

    const initBtn = document.getElementById('initBtn');
    const nextBtn = document.getElementById('nextBtn');
    const simulateAI = document.getElementById('simulateAI');
    const resetSession = document.getElementById('resetSession');
    const questionOutput = document.getElementById('questionOutput');
    const engineState = document.getElementById('engineState');
    const aiLog = document.getElementById('aiLog');
    const sessionData = document.getElementById('sessionData');

    let currentQuestion = 0;
    let state = {};

    async function renderEngineState() {
      engineState.innerHTML = '';
      Object.entries(state).forEach(([key, value]) => {
        const div = document.createElement('div');
        div.classList.add('metric');
        div.innerHTML = `<h3>${key}</h3><p>${typeof value === 'object' ? JSON.stringify(value) : value}</p>`;
        engineState.appendChild(div);
      });
    }

    async function updateSessionView() {
      const data = JSON.parse(localStorage.getItem('MCIF_Session') || '{}');
      sessionData.textContent = JSON.stringify(data, null, 2);
    }

    initBtn.addEventListener('click', async () => {
      await MCIFLogic.init();
      state = { phase: "Theme", step: 1, responses: [] };
      questionOutput.textContent = "Engine initialized. Ready to begin sequence.";
      renderEngineState();
      updateSessionView();
    });

    nextBtn.addEventListener('click', async () => {
      try {
        const questionSet = await MCIFData.getQuestionsForPhase(state.phase);
        const q = questionSet[currentQuestion] || { text: "End of phase." };
        questionOutput.textContent = JSON.stringify(q, null, 2);
        state.currentQuestion = q.text;
        currentQuestion++;
        renderEngineState();
        updateSessionView();
      } catch (err) {
        questionOutput.textContent = `Error loading question: ${err.message}`;
      }
    });

    simulateAI.addEventListener('click', async () => {
      try {
        const fakeInput = { phase: state.phase, text: state.currentQuestion || "None" };
        const aiResponse = {
          message: "Simulated AI response for debugging",
          insights: {
            tone: "Reflective",
            cognitivePath: "Pattern synthesis mode active"
          }
        };
        aiLog.textContent = JSON.stringify(aiResponse, null, 2);
      } catch (err) {
        aiLog.textContent = `AI simulation failed: ${err.message}`;
      }
    });

    resetSession.addEventListener('click', () => {
      localStorage.removeItem('MCIF_Session');
      state = {};
      currentQuestion = 0;
      questionOutput.textContent = "Session cleared.";
      engineState.innerHTML = '';
      sessionData.textContent = '{}';
      aiLog.textContent = 'Cleared.';
    });
  </script>
</body>
</html>
